#========================#
#     Binary Sensors     #
#========================#

- binary_sensor:

    #-----------------------------#
    #   -- Floorplan Mirrors --   #
    #-----------------------------#

    # These sensors are used to create mirror entities to items on the floorplan. For example,
    # there are four wall sconces in the theater, but the floorplan card only allows one element
    # in the SVG file with a given entity ID. By having sensors that mirror that one entity's
    # state, we can then place elements in the SVG file using those sensor IDs.    
    - name: 'Driveway Lights Mirror'
      unique_id: driveway_lights_mirror
      device_class: light
      state: "{{ is_state('switch.driveway_lights', 'on') }}"
    
    - name: 'Garage Lights Mirror'
      unique_id: garage_lights_mirror
      device_class: light
      state: "{{ is_state('switch.garage_lights', 'on') }}"
    
    - name: 'Hallway Lights Mirror'
      unique_id: hallway_lights_mirror
      device_class: light
      state: "{{ is_state('switch.hallway_lights', 'on') }}"
    
    - name: 'Kitchen Light Mirror'
      unique_id: kitchen_light_mirror
      device_class: light
      state: "{{ is_state('switch.kitchen_light', 'on') }}"
    
    - name: 'Snack Light Mirror'
      unique_id: snack_light_mirror
      device_class: light
      state: "{{ is_state('switch.snack_light', 'on') }}"
      
    - name: 'Theater Sconces Mirror'
      unique_id: theater_sconces_mirror
      device_class: light
      state: "{{ is_state('light.theater_sconces', 'on') }}"
    
    - name: 'Theater Ceiling Mirror'
      unique_id: theater_ceiling_mirror
      device_class: light
      state: "{{ is_state('light.theater_ceiling', 'on') }}"
    
    - name: 'Upstairs Bedroom Light Mirror'
      unique_id: upstairs_bedroom_light_mirror
      device_class: light
      state: "{{ is_state('switch.upstairs_bedroom_light', 'on') }}"

    #-------------------------#
    #   -- History Stats --   #
    #-------------------------#
    
    # These sensors are used to support history stats.
    
    # Family Room AV is true if the associated device is drawing power, and a grandchild
    # is not home or a grandchild is home and it's in the evening (I don't count a grandchild
    # watching YouTube or cartoon shows all day).
    - name: 'Family Room AV'
      unique_id: family_room_av
      state: >
        {{ states('sensor.sonoff_family_room_av_power') | float(0) > 10 and
           (is_state('input_boolean.children_home', 'off') or
             (is_state('input_boolean.children_home', 'on') and
              now().strftime('%H') >= '19')) }}
    
    # Cinema is true if the projector is drawing power, and the source device is not Shield TV
    # (we can't know if such devices are playing or not) or the source is Shield TV and it's in
    # playing state.
    - name: 'Cinema Projector'
      unique_id: cinema_projector
      state: >
        {{ states('sensor.projector_power') | float(0) > 0  and
           (is_state('switch.harmony_hub_stream_player', 'off') or
             (is_state('switch.harmony_hub_stream_player', 'on') and
              is_state('media_player.shield_tv', 'playing'))) }}

    #------------------------------#
    #   -- Device Power Flags --   #
    #------------------------------#
    
    # These indicate if a device or device group (such as an AV system) are drawing power.
    - name: Family Room AV System
      unique_id: family_room_av_system
      state: "{{ states('sensor.sonoff_family_room_av_power') | float(0) > 10 }}"
      
    - name: Theater AV System
      unique_id: theater_av_system
      state: "{{ states('sensor.projector_power') | float(0) > 0 }}"

    #-------------------------#
    #   -- Dryer Control --   #
    #-------------------------#
    
    # This sensor controls when we turn off the dryer. There are trend sensors to detect temperature and humidity falling,
    # but sometimes these can be spurious, for example getting 2 humidity falling events, then a temperature falling event.
    # So we have a counter for each type of event, and only turn this sensor on when both counters are above zero.
    - name: 'Dryer Done'
      unique_id: dryer_done
      state: "{{ states('counter.dryer_temperature_count') | int(0) > 0 and states('counter.dryer_humidity_count') | int(0) > 0 }}"
