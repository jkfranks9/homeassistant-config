#=======================#
#     Reminder Card     #
#=======================#

# Next event is for tasks that occur on a regular basis, such as changing an HVAC filter every 
# 4 months.
next_event:
  default:
    - amount: ''
  card:
    type: entities
    entities:
      - type: 'custom:multiple-entity-row'
        entity: '[[entity]]'
        icon: 'mdi:[[icon]]'
        name: '[[name]]'
        secondary_info: '[[interval]] [[period]] [[amount]]'
        hold_action:
          action: call-service
          service: '[[service]]'
          service_data:
            entity: '[[entity]]'
            interval: '[[interval]]'
    
    style: |
      {% if states.input_datetime | count > 0 %}
        {%- set ts_event = as_timestamp(states.[[entity]].state, default=0) %}
        {%- set ts_now = as_timestamp(now())|round(0) %}
        {%- set ts_delta = (ts_now - ts_event) %}
      {% else %}
        {% set ts_delta = (-86400) %}
      {% endif %}
      ha-card {
        border: solid 2px {% if (ts_delta >= 0) %}red {% elif ts_delta > (-86400) %}yellow {% else %}var(--card-background-color) {% endif %};
      }

#==================#
#     Bar Card     #
#==================#

severity_colors:
  default:
    - min: 0
    - max: 100
  card:
    type: custom:bar-card
    name: '[[name]]'
    entity: '[[entity]]'
    icon: '[[icon]]'
    entity_row: true
    height: 30px
    min: '[[min]]'
    max: '[[max]]'
    severity:
      - color: 'var(--bar-low-color)'
        from: '[[range1_from]]'
        to:   '[[range1_to]]'
      - color: 'var(--bar-medium-color)'
        from: '[[range2_from]]'
        to:   '[[range2_to]]'
      - color: 'var(--bar-high-color)'
        from: '[[range3_from]]'
        to:   '[[range3_to]]'

#=====================#
#     Button Card     #
#=====================#

button_card:
  default:
    - m0_show: 'false'
    - m0_extra: ''
    - m1_extra: ''
    - m2_extra: ''
    - m3_extra: ''
  card:
    type: custom:button-card
    entity: '[[entity]]'
    name: '[[name]]'
    triggers_update: all
    aspect_ratio: 3/2.3
    tap_action:
      action: 'none'
  
    styles:
      card:
        - background-color: var(--card-background-color)
        - border-radius: 0%
        - padding: 1%
        - font-size: 87%
        - text-transform: '[[transform]]'
      grid:
        - grid-template-areas: |
            [[[ 
              var col = '[[template_columns]]';
              if (col == 4)      return '"n n m0 m0" "i i m1 m1" "i i m2 m2" "stat stat m3 m3"';
              else if (col == 5) return '"n n m0 m0 m0" "i i m1 m1 m1" "i i m2 m2 m2" "stat stat m3 m3 m3"';
              else               return '"n n m0 m0 m0 m0" "i i m1 m1 m1 m1" "i i m2 m2 m2 m2" "stat stat m3 m3 m3 m3"';
            ]]]
        - grid-template-columns: |
            [[[ 
              var col = '[[template_columns]]';
              if (col == 4)      return '1fr 1fr 1fr 1fr';
              else if (col == 5) return '1fr 1fr 1fr 1fr 1fr';
              else               return '1fr 1fr 1fr 1fr 1fr 1fr';
            ]]]
        - grid-template-rows: 1fr 1fr 1fr 1fr
      name:
        #- font-weight: bold
        - font-size: 2.0em
        - align-self: middle
        - justify-self: start
        - padding-bottom: 0px
      img_cell:
        - justify-content: start
        - align-items: start
        - margin: 0%
      icon:
        - color: |
            [[[
              if (entity.state == '[[state_on]]') return '[[icon_color_on]]';
              else return '[[icon_color_off]]';
            ]]]
        - width: 70%
        - margin-top: 0%
    
      custom_fields:
        stat:
          - align-self: middle
          - justify-self: start
        m0:
          - align-self: middle
          - justify-self: start
        m1:
          - align-self: middle
          - justify-self: start
        m2:
          - align-self: middle
          - justify-self: start
        m3:
          - align-self: middle
          - justify-self: start
  
    custom_fields:
      stat: "[[[ return entity.state + '[[stat_text]]' ]]]"
      m0: |
        [[[
          if ('[[m0_show]]' == 'true') {
            var status = states['[[m0_entity]]'].state;
            return `<span>[[m0_name]]: ${status} [[m0_extra]]</span>`
          }
          return ``
        ]]]
      m1: |
        [[[
          var status = states['[[m1_entity]]'].state;
          return `<span>[[m1_name]]: ${status} [[m1_extra]]</span>`
        ]]]
      m2: |
        [[[
          var status = states['[[m2_entity]]'].state;
          return `<span>[[m2_name]]: ${status} [[m2_extra]]</span>`
        ]]]
      m3: |
        [[[
          var status = states['[[m3_entity]]'].state;
          return `<span>[[m3_name]]: ${status} [[m3_extra]]</span>`
        ]]]
