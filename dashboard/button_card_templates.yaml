#=================================#
#     Garage Door Button Card     #
#=================================#

garage_door_button:
  variables:
    var_entity: switch.shelly1_garage_north
    var_name_open: North open
    var_name_closed: North closed
  show_icon: true
  show_name: true
  icon: 'hass:garage'
  size: 30%
  tap_action:
    action: call-service
    service: switch.turn_on
    service_data:
      entity_id: '[[[ return variables.var_entity ]]]'
  state:
    - value: 'off'
      name: '[[[ return variables.var_name_open ]]]'
      icon: 'hass:garage-open'
    - value: 'on'
      name: '[[[ return variables.var_name_closed ]]]'

#============================#
#     Toggle Button Card     #
#============================#
toggle_button:
  show_icon: true
  show_name: true
  tap_action:
    action: toggle

#==================================#
#     Call Service Button Card     #
#==================================#
call_service_button:
  variables:
    var_script: script.mute_guest_bedroom_echo
  show_icon: true
  show_name: true
  tap_action:
    action: call-service
    service: script.turn_on
    service_data:
      entity_id: '[[[ return variables.var_script ]]]'

#=================================#
#     Light Group Button Card     #
#=================================#

light_group_button:
  show_icon: true
  show_name: false
  tap_action:
    action: >
      [[[
        if (entity.state == 'on')
          return 'toggle'
        else
          return 'none'
      ]]]
  state:
    - value: 'on'
      icon: mdi:home-lightbulb
    - value: 'off'
      icon: mdi:home-lightbulb-outline

#======================================#
#     Light Group Button Name Card     #
#======================================#

light_group_button_name:
  variables:
    entities_title: Lights
    entities_group: light.dummy
  
  show_icon: true
  show_name: true
  
  tap_action:
    action: fire-dom-event
    browser_mod:
      command: call-service
      service: script.popup_light_group
      service_data:
        deviceID:
          - this
        title: '[[[ return variables.entities_title ]]]'
        light_group: '[[[ return variables.entities_group ]]]'
  
  state:
    - value: 'on'
      icon: mdi:home-lightbulb
    - value: 'off'
      icon: mdi:home-lightbulb-outline

#=================================#
#     Temperature Button Card     #
#=================================#

temperature_button:
  show_icon: false
  show_name: false
  show_state: true
  tap_action:
    action: 'none'

#============================#
#     Motion Button Card     #
#============================#

motion_button:
  show_icon: true
  show_name: false
  tap_action:
    action: 'none'
  state:
    - value: 'on'
      icon: mdi:motion-sensor
    - value: 'off'
      icon: mdi:motion-sensor-off

#===========================#
#     Blank Button Card     #
#===========================#

blank_button:
  show_icon: false
  show_name: false
  show_state: false
  tap_action:
    action: 'none'

#===============================#
#     Condensed Button Card     #
#===============================#

# Used as the basis for various condensed format buttons.
condensed_button:
  variables:
    color: 'var(--card-background-color)'
  
  show_icon: true
  show_state: true
  
  styles:
    card:
      - background-color: '[[[ return variables.color || "transparent" ]]]'
      - overflow: visible
      - box-shadow: none
      - padding: 2px 0 5px 2px
      - display: flex
      - width: fit-content
      - margin-right: 15px
      - border: 1px solid gray
    grid:
      - display: contents
    img_cell:
      - display: contents
    icon:
      - width: 70%
      - position: absolute
      - color: silver
    state:
      - font-size: 3.5em
      - text-shadow: 0 0 2px black
      - overflow: visible
      - margin-top: '-10px'
    name:
      - color: var(--primary-color)
      - text-shadow: 0 0 2px black
      - overflow: visible
      - font-size: 0.75em
      - font-weight: 500
      - position: absolute
      - transform: rotate(90deg)
      - transform-origin: right bottom
      - bottom: 0
      - right: 0
      - z-index: 10

#================================#
#     Thermostat Button Card     #
#================================#

thermostat:
  template: condensed_button
  
  variables:
    color_setpoint_off: 'var(--bar-low-color)'
    color_setpoint_idle: 'var(--bar-low-color)'
    color_setpoint_cool: 'var(--bar-medium-color)'
    color_setpoint_heat: 'var(--bar-high-color)'
    text_setpoint_off: 'var(--primary-text-color)'
    text_setpoint_idle: 'var(--disabled-text-color)'
    text_setpoint_cool: 'var(--primary-text-color)'
    text_setpoint_heat: 'var(--primary-text-color)'
    
  icon: 'mdi:fan'
  state_display: |-
    [[[ 
      return Math.round(entity.attributes.current_temperature).toString()+"°" 
    ]]]
    
  custom_fields:
    preset: |
      [[[
        return `<div style="line-height:1">${entity.attributes.preset_mode}</div>`;
      ]]]
      
    humidity:
      card:
        type: 'custom:button-card'
        show_icon: true
        icon: 'mdi:water-percent'
        show_name: false
        show_state: true
        state_display: |
          [[[
            if (entity.attributes.current_humidity) 
              return entity.attributes.current_humidity;
          ]]]
        styles:
          grid:
            - grid-template-areas: '"s i"'
          img_cell:
            - display: contents
          state:
            - color: 'var(--disabled-text-color)'
            - font-size: 0.8em
            - align-self: flex-end
          card:
            - padding: 0
            - padding-left: 2px
            - background-color: 'var(--bar-low-color)'
          icon:
            - color: 'var(--disabled-text-color)'
            - width: 18px
            - height: 15px
            - margin-top: '-4px'
            - margin-left: '-4px'
            - margin-right: '-3px'
      
    setpoint:
      card:
        type: 'custom:button-card'
        show_icon: false
        show_name: true
        show_state: true
        state_display: |
          [[[ 
            return entity.attributes.temperature 
              ? entity.attributes.temperature + "°" 
              : entity.attributes.target_temp_low
                ? entity.attributes.target_temp_low + "°" 
                : ''
          ]]]
        name: |
          [[[ 
            return entity.attributes.target_temp_high
              ? entity.attributes.target_temp_high + "°" 
              : ''
          ]]]
        styles:
          state:
            - font-size: 0.8em
            - color: |
                [[[ 
                  switch(entity.attributes.hvac_action) {
                    case "cool":
                    case "cooling":
                      return variables.text_setpoint_cool;
                    case "heat":
                    case "heating":
                      return variables.text_setpoint_heat;
                    default:
                      return entity.state == "off"
                        ? variables.text_setpoint_off
                        : variables.text_setpoint_idle 
                  }
                ]]]
          name:
            - font-size: 0.8em
            - color: |
                [[[ 
                  switch(entity.attributes.hvac_action) {
                    case "cool":
                    case "cooling":
                      return variables.text_setpoint_cool;
                    case "heat":
                    case "heating":
                      return variables.text_setpoint_heat;
                    default:
                      return entity.state == "off"
                        ? variables.text_setpoint_off
                        : variables.text_setpoint_idle 
                  }
                ]]]
          card:
            - padding: 0 2px
            - background-color: |
                [[[ 
                  switch(entity.attributes.hvac_action) {
                    case "cool":
                    case "cooling":
                      return variables.color_setpoint_cool;
                    case "heat":
                    case "heating":
                      return variables.color_setpoint_heat;
                    default:
                      return entity.state == "off"
                        ? variables.color_setpoint_off
                        : variables.color_setpoint_idle 
                  }
                ]]]
    
  state:
    - id: value_any
      operator: '!='
      value: all
      spin: true
    
  styles:
    icon:
      - left: 3px
      - display: >-
          [[[ return entity.attributes.fan &&
          entity.attributes.fan === 'on' ? "block" : "none" ]]]
    state:
      - color: var(--primary-text-color)
      - z-index: 1
      
    custom_fields:
      preset:
        - text-shadow: 0 0 0.2em black
        - overflow: visible
        - font-size: 0.6em
        - position: absolute
        - bottom: 1px
        - right: 32px
        - z-index: 1
        
      mode:
        - position: absolute
        - bottom: 18px
        - right: 2px
        
      setpoint:
        - position: absolute
        - bottom: 0
        - right: 0
        - z-index: 1
        
      humidity:
        - z-index: 2
        - position: absolute
        - bottom: 0
        - left: 0
        - display: flex

#=================================#
#     Temperature Button Card     #
#=================================#

temperature:
  template: condensed_button
  
  variables:
    min_entity: ''
    max_entity: ''
    humidity_entity: ''
    
  show_icon: false
  
  state_display: |-
    [[[ 
      return Math.round(entity.state).toString()+"°" 
    ]]]
    
  custom_fields:
    humidity:
      card:
        type: 'custom:button-card'
        show_icon: true
        icon: 'mdi:water-percent'
        show_name: false
        show_state: true
        state_display: |
          [[[
            return Math.round(states[variables.humidity_entity].state).toString();
          ]]]
        styles:
          grid:
            - grid-template-areas: '"s i"'
          img_cell:
            - display: contents
          state:
            - color: 'var(--disabled-text-color)'
            - font-size: 0.8em
            - align-self: flex-end
          card:
            - padding: 0
            - padding-left: 2px
            - background-color: 'var(--bar-low-color)'
          icon:
            - color: 'var(--disabled-text-color)'
            - width: 18px
            - height: 15px
            - margin-top: '-4px'
            - margin-left: '-4px'
            - margin-right: '-3px'
      
    minmax:
      card:
        type: 'custom:button-card'
        show_icon: false
        show_name: true
        show_state: true
        state_display: |
          [[[ 
            return Math.round(states[variables.max_entity].state).toString();
          ]]]
        name: |
          [[[ 
            return Math.round(states[variables.min_entity].state).toString();
          ]]]
        styles:
          state:
            - font-size: 0.8em
            - color: var(--disabled-text-color)
          name:
            - font-size: 0.8em
            - color: var(--disabled-text-color)
          card:
            - padding: 0 2px
            - background-color: var(--bar-low-color)
    
  state:
    - id: value_any
      operator: '!='
      value: all
    
  styles:
    state:
      - color: var(--primary-text-color)
      - z-index: 1
      
    custom_fields:
      minmax:
        - position: absolute
        - bottom: 0
        - right: 0
        - z-index: 1
        
      humidity:
        - z-index: 2
        - position: absolute
        - bottom: 0
        - left: 0
        - display: flex

#===============================#
#     HVAC Vent Button Card     #
#===============================#

hvac_vent:
  template: condensed_button
  
  variables:
    color: 'var(--card-background-color)'
    
  state_display: |-
    [[[ 
      return "00°" 
    ]]]
    
  custom_fields:
    pos: |
      [[[
        if (entity.state == 'closed')
          return `<div style="line-height:1">Closed</div>`;
        else if (entity.attributes.current_position == 100)
          return `<div style="line-height:1">Open</div>`;
        else
          return `<div style="line-height:1">${entity.attributes.current_position}%</div>`;
      ]]]
    
  state:
    - value: 'open'
      icon: mdi:hvac
    - value: 'closed'
      icon: mdi:hvac-off
    
  styles:
    icon:
      - color: var(--primary-text-color)
      - width: 80%
      - left: 13px
      - display: block
      - z-index: 10
    state:
      - color: var(--card-background-color)
      - z-index: 0
      
    custom_fields:
      pos:
        - text-shadow: 0 0 0.2em black
        - overflow: visible
        - font-size: 0.6em
        - position: absolute
        - bottom: 1px
        - right: 32px
        - z-index: 1
